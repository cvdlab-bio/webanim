var marjenmedia={};marjenmedia.util3d={};marjenmedia.util3d.PdbParser={loadFile:function(a){$.get(a,function(b){marjenmedia.util3d.PdbParser.getLines(b)})},getLines:function(c){var b=c;var a=b.split("\n");marjenmedia.util3d.PdbParser.createDOA(a)},stringStartsWith:function(b,a){return b.match("^"+a)==a},createDOA:function createDOA(k){var f=new Array();var d=new Array();var j=k.length;for(var c=0;c<j;c++){var l=k[c];var h=marjenmedia.util3d.PdbParser;if(h.stringStartsWith(l,"HELIX")){var g=h.createHelixDO(l);d.push(g)}else{if(h.stringStartsWith(l,"SHEET")){var a=h.createSheetDO(l);d.push(a)}else{if(h.stringStartsWith(l,"ATOM")){var b=h.createAtomDO(l);f.push(b)}else{if(h.stringStartsWith(l,"HETATM")){var e=h.createHetatmDO(l);f.push(e)}}}}}d=marjenmedia.util3d.PdbParser.addAminnoAcidArray(d);sendDOA(f,d)},createAtomDO:function(a){var b={};b.molType="ATOM";b.atomNum=parseInt(a.substring(7,11));b.atomType=jQuery.trim(a.substring(12,16));b.aminoAcidName=jQuery.trim(a.substring(17,20));b.subunitType=jQuery.trim(a.substring(21,22));b.aminoAcidNum=parseInt(a.substring(23,26));b.x=parseFloat(a.substring(30,38));b.y=parseFloat(a.substring(46,54));b.z=parseFloat(a.substring(38,46));b.atomName=jQuery.trim(a.substring(76,78));return b},createHetatmDO:function(a){var b={};b.molType="HETATM";b.atomNum=parseInt(a.substring(7,11));b.atomType=jQuery.trim(a.substring(12,16));b.aminoAcidName=jQuery.trim(a.substring(17,20));b.subunitType=jQuery.trim(a.substring(21,22));b.aminoAcidNum=parseInt(a.substring(23,26));b.x=parseFloat(a.substring(30,38));b.y=parseFloat(a.substring(46,54));b.z=parseFloat(a.substring(38,46));b.atomName=jQuery.trim(a.substring(76,78));return b},createHelixDO:function(a){var b={};b.structureType="HELIX";b.structureNum=parseInt(a.substring(8,10));b.structureName=jQuery.trim(a.substring(12,14));b.startName=jQuery.trim(a.substring(15,18));b.startSubunit=jQuery.trim(a.substring(18,21));b.startNum=parseInt(a.substring(22,25));b.endNum=parseInt(a.substring(33,37));return b},createSheetDO:function(a){var b={};b.structureType="SHEET";b.structureNum=parseInt(a.substring(8,10));b.structureName=jQuery.trim(a.substring(12,14));b.startName=jQuery.trim(a.substring(17,20));b.startSubunit=jQuery.trim(a.substring(20,23));b.startNum=parseInt(a.substring(23,26));b.endNum=parseInt(a.substring(33,37));return b},addAminnoAcidArray:function(a){var d=a.length;for(var b=0;b<d;b++){var c=a[b];c.aminnoAcidArray=marjenmedia.util3d.PdbParser.createNumberArray(c.startNum,c.endNum)}return a},createNumberArray:function(d,c){var a=new Array();for(var b=d;b<c+1;b++){a.push(b)}return a}};marjenmedia.util3d.SelectAtomDOs=function(){};marjenmedia.util3d.SelectAtomDOs.prototype.selectAtomNum=function(a,b){var e=new Array();var d=a.length;for(var c=0;c<d;c++){var f=a[c];if(f.atomNum==b){e.push(f)}}return e};marjenmedia.util3d.SelectAtomDOs.prototype.selectAtomName=function(a,b){var e=new Array();var d=a.length;for(var c=0;c<d;c++){var f=a[c];if(f.atomName==b){e.push(f)}}return e};marjenmedia.util3d.SelectAtomDOs.prototype.selectMolType=function(a,b){var e=new Array();var d=a.length;for(var c=0;c<d;c++){var f=a[c];if(f.molType==b){e.push(f)}}return e};marjenmedia.util3d.SelectAtomDOs.prototype.selectAtomType=function(a,b){var e=new Array();var d=a.length;for(var c=0;c<d;c++){var f=a[c];if(f.atomType==b){e.push(f)}}return e};marjenmedia.util3d.SelectAtomDOs.prototype.selectSubunitType=function(a,e){var d=new Array();var c=a.length;for(var b=0;b<c;b++){var f=a[b];if(f.subunitType==e){d.push(f)}}return d};marjenmedia.util3d.SelectAtomDOs.prototype.selectAminoAcidName=function(a,e){var d=new Array();var c=a.length;for(var b=0;b<c;b++){var f=a[b];if(f.aminoAcidName==e){d.push(f)}}return d};marjenmedia.util3d.SelectAtomDOs.prototype.selectAminoAcidNum=function selectAminoAcidNum(a,b){var e=new Array();var d=a.length;for(var c=0;c<d;c++){var f=a[c];if(f.aminoAcidNum==b){e.push(f)}}return e};marjenmedia.util3d.SelectAtomDOs.prototype.getRemainder=function(a,h){var f=this.aminoAcidNumArray.length;var e=concatAminoAcidArrays(a);var b=e.length;for(var d=0;d<b;d++){for(var c=0;c<f;c++){if(h[c]==e[d]){var g=h.splice(c,1);f=h.length}}}return h};marjenmedia.util3d.SelectAtomDOs.prototype.concatAminoAcidArrays=function(a){var e=a.length;var d=new Array();for(var b=0;b<e;b++){var c=a[b];d=d.concat(c.aminnoAcidArray)}return d};marjenmedia.util3d.SelectAtomDOs.prototype.selectDNAbackbone=function(a){var b=this.multiSelect(["P","OP1","OP2","O5'","C5'","C4'","O4'","C3'","O3'","C2'","C1'"],a,"atomType");return b},marjenmedia.util3d.SelectAtomDOs.prototype.selectPhosphate=function(a){var b=this.multiSelect(["P","OP1","OP2"],a,"atomType");return b};marjenmedia.util3d.SelectAtomDOs.prototype.selectRibose=function(a){var b=this.multiSelect(["O5'","C5'","C4'","O4'","C3'","O3'","C2'","C1'"],a,"atomType");return b};marjenmedia.util3d.SelectAtomDOs.prototype.selectBase=function(a,b){var d=this.selectNucleotideNum(a,b);var c=d[0].extra.aminoAcidName;if(c=="DA"){d=this.selectA(d,-1)}else{if(c=="DC"){d=this.selectC(d,-1)}else{if(c=="DG"){d=this.selectG(d,-1)}else{if(c=="DT"){d=this.selectT(d,-1)}}}}return d};marjenmedia.util3d.SelectAtomDOs.prototype.selectA=function(a,b){var c=this.selectNucleotideName(a,"DA");c=this.multiSelect(["N9","C8","N7","C5","C6","N6","N1","C2","N3","C4"],c,"atomType");if(b==-1){}else{c=this.selectNucleotideNum(c,b)}return c};marjenmedia.util3d.SelectAtomDOs.prototype.selectC=function(a,b){var c=this.selectNucleotideName(a,"DC");c=this.multiSelect(["N1","C2","O2","N3","C4","N4","C5","C6"],c,"atomType");if(b==-1){}else{c=this.selectNucleotideNum(c,b)}return c};marjenmedia.util3d.SelectAtomDOs.prototype.selectG=function(a,b){var c=this.selectNucleotideName(a,"DG");c=this.multiSelect(["N9","C8","N7","C5","C6","O6","N1","C2","N2","N3","C4"],c,"atomType");if(b==-1){}else{c=this.selectNucleotideNum(c,b)}return c};marjenmedia.util3d.SelectAtomDOs.prototype.selectT=function(a,b){var c=this.selectNucleotideName(a,"DT");c=this.multiSelect(["N1","C2","O2","N3","C4","O4","C5","C7","C6"],c,"atomType");if(b==-1){}else{c=this.selectNucleotideNum(c,b)}return c};marjenmedia.util3d.SelectAtomDOs.prototype.selectNucleotideName=function(a,e){var d=new Array();var c=a.length;for(var b=0;b<c;b++){var f=a[b];if(f.aminoAcidName==e){d.push(f)}}return d};marjenmedia.util3d.SelectAtomDOs.prototype.selectNucleotideNum=function(a,b){var e=new Array();var d=a.length;for(var c=0;c<d;c++){var f=a[c];if(f.aminoAcidNum==b){e.push(f)}}return e};marjenmedia.util3d.SelectAtomDOs.prototype.selectPeptideChain=function selectPeptideChain(a){var b=this.multiSelect(["N","CA","C"],a,"atomType");return b};marjenmedia.util3d.SelectAtomDOs.prototype.multiSelect=function(k,j,b){var f=new Array();var h=k.length;for(var g=0;g<h;g++){var l=k[g];if(b=="aninoAcidNum"){var e=this.selectNucleotideNum(j,l);f=f.concat(e)}if(b=="aninoAcidName"){var d=this.selectNucleotideName(j,l);f=f.concat(d)}if(b=="subunitType"){var c=this.selectSubunitType(j,l);f=f.concat(c)}if(b=="molType"){var a=this.selectMolType(j,l);f=f.concat(a)}if(b=="atomType"){var o=this.selectAtomType(j,l);f=f.concat(o)}if(b=="atomName"){var n=this.selectAtomName(j,l);f=f.concat(n)}if(b=="atomNum"){var m=this.selectAtomNum(j,l);f=f.concat(m)}}return f};marjenmedia.util3d.SelectAtomDOs.prototype.selectStructure2ndDOA=function(a,e,d){if(e=="startSubunit"){var f=new Array();var g=a.length;for(var b=0;b<g;b++){var c=a[b];if(c.startSubunit==d){f.push(c)}}}return f};marjenmedia.util3d.SelectAtomDOs.prototype.getRemainder=function(a,h){var f=h.length;var e=this.concatAminoAcidArrays(a);var b=e.length;for(var d=0;d<b;d++){for(var c=0;c<f;c++){if(h[c]==e[d]){var g=h.splice(c,1);f=h.length}}}return h};marjenmedia.util3d.SelectAtomDOs.prototype.concatAminoAcidArrays=function(a){var e=a.length;var d=new Array();for(var b=0;b<e;b++){var c=a[b];d=d.concat(c.aminnoAcidArray)}return d};marjenmedia.util3d.SelectAtomDOs.prototype.createNumberArray=function(d,c){var a=new Array();for(var b=d;b<c+1;b++){a.push(b)}return a};marjenmedia.molecule={};marjenmedia.molecule.threejs={};marjenmedia.molecule.threejs.MoleculeMaker=function(){};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createAtoms=function(k,m,l,g,f,d,a,n){this.sphereW=a;this.sphereH=n;var b=[];this.createMaterials();this.createGeometries(l);var h=k.length;for(var e=0;e<h;e++){var c=k[e];var j=this.createAtom(c,l);j.position.x=(c.x*m)+g;j.position.y=(c.y*m)+f;j.position.z=(c.z*m)+d;b.push(j)}return b};marjenmedia.molecule.threejs.MoleculeMaker.prototype.addAtoms=function(e,b){var d=e.length;for(var a=0;a<d;a++){var c=e[a];b.add(c)}return e};marjenmedia.molecule.threejs.MoleculeMaker.prototype.removeAtoms=function(e,c){var d=e.length;for(var a=0;a<d;a++){var b=e[a];c.remove(b)}return e};marjenmedia.molecule.threejs.MoleculeMaker.prototype.destroyAtoms=function(e,c){var d=e.length;for(var a=0;a<d;a++){var b=e[a]}e=[];return e};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createBonds=function(a,c,n,d){var b=[];var m=c.length;var k=a.length;for(var h=0;h<k;h++){for(var g=0;g<m;g++){var f=a[h];var e=c[g];if(f.atom1Num==e.atomNum){f.atom1Pos=new THREE.Vector3(e.x*n,e.y*n,e.z*n);f.atom1Name=e.atomName}if(f.atom2Num==e.atomNum){f.atom2Pos=new THREE.Vector3(e.x*n,e.y*n,e.z*n);f.atom2Name=e.atomName}}}var l=this.createBondObj3d(a,d);return l};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createRibbons=function(e,j,h){var g=e.length;var a=null;var b=new Array();for(var d=0;d<g;d++){var f=e[d];if(a==null){a=f}else{var c={};c.atom1Pos=new THREE.Vector3(a.x*h,a.y*h,a.z*h);c.atom2Pos=new THREE.Vector3(f.x*h,f.y*h,f.z*h);c.extra=a;var k=this.createRibbonAminoAcid(c,j);a=f;b.push(k)}}return b};marjenmedia.molecule.threejs.MoleculeMaker.prototype.changeAtomsColor=function(g,c){var e=[];var f=g.length;for(var a=0;a<f;a++){var d=g[a];var b=new THREE.MeshPhongMaterial({color:c,ambient:c,specular:16777215,shininess:30,shading:THREE.SmoothShading});d.materials=[b];e.push(d)}return e};marjenmedia.molecule.threejs.MoleculeMaker.prototype.normalAtomColor=function(e){var c=new Array();var d=e.length;for(var a=0;a<d;a++){var b=e[a];b=this.normalAtomColor(b);c.push(b)}return c};marjenmedia.molecule.threejs.MoleculeMaker.prototype.changeAtomMaterial=function(f,b){var d=[];var e=f.length;for(var a=0;a<e;a++){var c=f[a];c.materials=[b];d.push(c)}return d};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createAtom=function(d,a){var c=d.atomName;var b;if(c=="C"){b=new THREE.Mesh(this.Cgeo,this.Cmat)}if(c=="N"){b=new THREE.Mesh(this.Ngeo,this.Nmat)}if(c=="O"){b=new THREE.Mesh(this.Ogeo,this.Omat)}if(c=="S"){b=new THREE.Mesh(this.Sgeo,this.Smat)}if(c=="P"){b=new THREE.Mesh(this.Pgeo,this.Pmat)}if(c=="H"){b=new THREE.Mesh(this.Hgeo,this.Hmat)}if(c=="FE"){b=new THREE.Mesh(this.FEgeo,this.FEmat)}b.extra=d;b.name=c+"-"+d.aminoAcidName;return b};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createBondObj3d=function(d,g){var f=[];var b=d.length;for(var c=0;c<b;c++){var e=d[c];var a=this.createBond(e,g);f.push(a)}return f};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createBond=function(d,e){if(!e){var b=new THREE.MeshLambertMaterial({color:16645629,shading:THREE.SmoothShading})}else{var b=e}var a=d.atom1Pos.distanceTo(d.atom2Pos);d.bondLength=a;var h=new THREE.CylinderGeometry(1,1,a,16,4,false);h.applyMatrix(new THREE.Matrix4().setRotationFromEuler(new THREE.Vector3(Math.PI/2,Math.PI,0)));var c=new THREE.Object3D();c.position.x=d.atom1Pos.x;c.position.y=d.atom1Pos.y;c.position.z=d.atom1Pos.z;if(d.numOfBonds==1){var g=new THREE.Mesh(h,b);c.add(g)}else{if(d.numOfBonds==2){var g=new THREE.Mesh(h,b);g.position.y=-2;c.add(g);var f=new THREE.Mesh(h,b);g.position.y=2;c.add(f)}else{if(d.numOfBonds==3){}}}c.lookAt(d.atom2Pos);c.translateZ(a/2);return c};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createRibbonAminoAcid=function(c,b){var a=c.atom1Pos.distanceTo(c.atom2Pos);c.bondLength=a;var e=new THREE.CubeGeometry(5,5,a);var d=new THREE.Mesh(e,b);d.position.x=c.atom1Pos.x;d.position.y=c.atom1Pos.y;d.position.z=c.atom1Pos.z;d.lookAt(c.atom2Pos);d.translateZ(a/2);d.extra=c.extra;return d};marjenmedia.molecule.threejs.MoleculeMaker.prototype.normalAtomMaterial=function(a){var c=a.extra;var b=c.atomName;if(b=="C"){a.material=_Cmat}if(b=="N"){a.material=_Nmat}if(b=="O"){a.material=_Omat}if(b=="S"){a.material=_Smat}if(b=="P"){a.material=_Pmat}if(b=="H"){a.material=_Hmat}if(b=="FE"){a.material=_FEmat}return a};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createMaterials=function(){this.Cmat=this.createAtomMaterial(9474192);this.Nmat=this.createAtomMaterial(3166456);this.Omat=this.createAtomMaterial(16715021);this.Smat=this.createAtomMaterial(16777008);this.Pmat=this.createAtomMaterial(16744448);this.Hmat=this.createAtomMaterial(16777215);this.FEmat=this.createAtomMaterial(14706227)};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createGeometries=function(b){var c=8;var a=8;if(this.sphereW){c=this.sphereW;a=this.sphereH}this.Cgeo=this.createAtomGeometry(b,0.76,c,a);this.Ngeo=this.createAtomGeometry(b,0.71,c,a);this.Ogeo=this.createAtomGeometry(b,0.66,c,a);this.Sgeo=this.createAtomGeometry(b,1.05,c,a);this.Pgeo=this.createAtomGeometry(b,1.07,c,a);this.Hgeo=this.createAtomGeometry(b,0.31,c,a);this.FEgeo=this.createAtomGeometry(b,1.32,c,a)};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createAtomMaterial=function(b){var a=new THREE.MeshPhongMaterial({ambient:b,color:b,specular:5592405,shininess:60});return a};marjenmedia.molecule.threejs.MoleculeMaker.prototype.createAtomGeometry=function(c,d,e,b){var a=d*c;var f=new THREE.SphereGeometry(a,e,b);return f};